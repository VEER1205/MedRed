<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedRed ‚Ä¢ Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      :root {
        --background: hsl(0, 0%, 7%);
        --foreground: hsl(0, 0%, 98%);
        --primary: hsl(0, 72%, 58%);
        --primary-dark: hsl(0, 72%, 48%);
        --accent: hsl(0, 85%, 65%);
        --muted: hsl(0, 0%, 65%);
        --border: hsl(0, 0%, 18%);
        --card-bg: rgba(26, 26, 26, 0.4);
        --ok: #22c55e;
        --error: #ef4444;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        background-color: var(--background);
        color: var(--foreground);
        overflow-x: hidden;
        min-height: 100vh;
        position: relative;
      }

      /* Canvas Background */
      #canvas {
        pointer-events: none;
        position: fixed;
        inset: 0;
        z-index: 0;
      }

      /* Floating blobs */
      .blob {
        position: fixed;
        border-radius: 50%;
        filter: blur(120px);
        animation: float 6s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
      }

      .blob-1 {
        top: 20%;
        left: 10%;
        width: 20rem;
        height: 20rem;
        background: rgba(234, 67, 53, 0.15);
      }

      .blob-2 {
        bottom: 20%;
        right: 10%;
        width: 24rem;
        height: 24rem;
        background: rgba(255, 82, 82, 0.15);
        animation-delay: 2s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-40px) scale(1.05);
        }
      }

      /* Navbar */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: var(--card-bg);
        backdrop-filter: blur(24px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .navbar .container-fluid {
        padding: 1rem 1.5rem;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        font-size: 1.5rem;
        font-weight: 700;
      }

      .logo-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 0.5rem;
        background: rgba(234, 67, 53, 0.1);
      }

      .gradient-text {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav-links {
        display: none;
        gap: 2rem;
      }

      @media (min-width: 768px) {
        .nav-links {
          display: flex;
        }
      }

      .nav-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }

      .nav-links a:hover {
        color: var(--foreground);
      }

      .avatar {
        position: relative;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #fff;
        font-weight: 800;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        user-select: none;
      }

      .avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
      }

      .user-menu {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 200px;
        background: var(--card-bg);
        backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        opacity: 0;
        pointer-events: none;
        transform: translateY(-8px);
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .user-menu.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }

      .menu-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        color: var(--foreground);
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: background 0.2s ease;
        cursor: pointer;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
      }

      .menu-item:first-child {
        border-radius: 12px 12px 0 0;
      }

      .menu-item:last-child {
        border-radius: 0 0 12px 12px;
      }

      .menu-item:hover {
        background: rgba(255, 255, 255, 0.06);
      }

      .menu-item.danger {
        color: var(--error);
      }

      .menu-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: 4px 0;
      }

      .navbar-toggler {
        border: 1px solid rgba(234, 67, 53, 0.5);
        padding: 0.25rem 0.5rem;
        border-radius: 8px;
      }

      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28239, 68, 68, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='m4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }

      .mobile-menu {
        display: none;
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .mobile-menu.open {
        display: flex;
      }

      .mobile-menu a {
        padding: 0.9rem 1rem;
        border-radius: 0.75rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
      }

      .mobile-menu a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      /* Main Content */
      .main-content {
        margin-top: 80px;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .title {
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        color: #fff;
      }

      .subtitle {
        color: var(--muted);
        margin-top: 6px;
        font-size: 0.95rem;
      }

      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: var(--foreground);
        padding: 12px 20px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border-color: rgba(220, 38, 38, 0.4);
        color: #fff;
        box-shadow: 0 0 20px hsla(0, 72%, 58%, 0.3);
      }

      .btn-primary:hover {
        box-shadow: 0 0 30px hsla(0, 72%, 58%, 0.5);
      }

      .btn[hidden] {
        display: none !important;
      }

      /* DNA Strip */
      .dna-strip {
        position: relative;
        height: 120px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        background: linear-gradient(
            to right,
            rgba(220, 38, 38, 0.06) 0%,
            rgba(220, 38, 38, 0.02) 100%
          ),
          rgba(255, 255, 255, 0.02);
        overflow: hidden;
        margin-bottom: 30px;
        backdrop-filter: blur(24px);
      }

      .dna-scene {
        position: absolute;
        inset: 0;
        perspective: 800px;
      }

      .dna {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-style: preserve-3d;
        will-change: transform;
      }

      .node {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: radial-gradient(
          circle at 30% 30%,
          #fff,
          #f87171 60%,
          #b91c1c
        );
        box-shadow: 0 0 10px rgba(220, 38, 38, 0.55);
        will-change: transform, opacity, filter;
      }

      .node.back {
        filter: brightness(0.8) saturate(0.9);
        opacity: 0.75;
        box-shadow: none;
      }

      /* Grid */
      .grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      }

      @media (max-width: 768px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card-bg);
        backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 14px;
        padding: 24px;
        transition: all 0.3s ease;
        animation: fadeUp 0.3s ease both;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
        border-color: rgba(255, 255, 255, 0.15);
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(220, 38, 38, 0.12);
        color: var(--primary);
        font-size: 18px;
        border: 1px solid rgba(220, 38, 38, 0.25);
      }

      .card-title {
        font-weight: 700;
        font-size: 1.1rem;
        letter-spacing: 0.2px;
        color: #fff;
      }

      /* Info Rows */
      .rows {
        display: grid;
        gap: 12px;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1.5fr;
        gap: 12px;
        align-items: center;
        padding: 12px 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.02);
        transition: all 0.2s ease;
      }

      .row:hover {
        background: rgba(255, 255, 255, 0.04);
      }

      .label {
        color: var(--muted);
        font-weight: 600;
        font-size: 0.9rem;
      }

      .value {
        display: flex;
        justify-content: flex-end;
      }

      .display {
        font-weight: 700;
        color: #fff;
      }

      .editor {
        display: none;
        width: 100%;
      }

      .input {
        width: 100%;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        color: #ffffff;
        font-weight: 600;
        outline: none;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .input::placeholder {
        color: #888888;
      }

      .input:focus {
        border-color: var(--primary);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
      }

      .input.error {
        border-color: var(--error);
        background: rgba(239, 68, 68, 0.05);
      }

      .input.error:focus {
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
      }

      .error-message {
        color: var(--error);
        font-size: 0.75rem;
        font-weight: 600;
        margin-top: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        animation: slideDown 0.2s ease;
      }

      .error-message::before {
        content: "‚ö†";
        font-size: 14px;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Edit Mode */
      body.editing .display {
        display: none;
      }

      body.editing .editor {
        display: block;
      }

      body.editing .card {
        border-color: rgba(220, 38, 38, 0.3);
        background: rgba(26, 26, 26, 0.6);
      }

      /* Reminders */
      .reminders {
        grid-column: 1 / -1;
      }

      .rem-list {
        display: grid;
        gap: 12px;
      }

      .rem {
        display: grid;
        grid-template-columns: 110px 1fr auto;
        gap: 16px;
        align-items: center;
        padding: 16px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.02);
        transition: all 0.2s ease;
      }

      .rem:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(255, 255, 255, 0.12);
      }

      .time {
        text-align: center;
      }

      .big {
        font-weight: 800;
        font-size: 1.1rem;
      }

      .small {
        color: var(--muted);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 4px;
      }

      .med .name {
        font-weight: 700;
        font-size: 1rem;
        margin-bottom: 4px;
      }

      .med .dose {
        color: var(--muted);
        font-size: 0.85rem;
      }

      .chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .chip {
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.03);
        color: var(--muted);
        font-weight: 700;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .chip:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .chip:active {
        transform: translateY(0);
      }

      .chip.done {
        color: #10b981;
        border-color: rgba(16, 185, 129, 0.4);
        background: rgba(16, 185, 129, 0.08);
      }

      /* Toast */
      .toast-container {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 2000;
        display: grid;
        gap: 10px;
        width: min(340px, calc(100vw - 40px));
      }

      .toast-item {
        background: var(--card-bg);
        backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--foreground);
        padding: 14px 18px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: translateY(10px);
        animation: toastIn 0.3s ease forwards;
      }

      @keyframes toastIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .title {
          font-size: 1.5rem;
        }

        .rem {
          grid-template-columns: 1fr;
          text-align: center;
        }

        .time {
          padding-bottom: 12px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chips {
          justify-content: center;
        }

        .row {
          grid-template-columns: 1fr;
          text-align: center;
        }

        .value {
          justify-content: center;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
        .dna-scene {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Canvas Background -->
    <canvas id="canvas"></canvas>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a class="logo" href="/">
          <div class="logo-icon">
            <i
              class="fas fa-capsules"
              style="color: #ef4444; font-size: 20px"
            ></i>
          </div>
          <span class="gradient-text">MedRed</span>
        </a>

        <button class="navbar-toggler" type="button" id="menuBtn">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="nav-links mx-auto">
            <a href="/">Home</a>
            <a href="/Reminders">Reminders</a>
          </div>
        </div>

        <div style="position: relative">
          <div class="avatar" id="navUserAvatar">JD</div>
          <div class="user-menu" id="userMenu">
            <div class="menu-divider"></div>
            <button
              class="menu-item danger"
              onclick="if(confirm('Are you sure you want to logout?')) window.location.href='/api/logout'"
            >
              <i class="fas fa-sign-out-alt"></i>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div class="mobile-menu" id="mobileMenu">
        <a href="/">Home</a>
        <a href="/Reminders">Reminders</a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <div class="container">
        <!-- Header -->
        <div class="header">
          <div>
            <div class="title">
              Welcome back, <span id="welcomeName">John</span>
            </div>
            <div class="subtitle">Your personalized health overview</div>
          </div>
          <div class="actions">
            <button class="btn" id="cancelBtn" hidden>
              <i class="fas fa-times"></i> Cancel
            </button>
            <button class="btn btn-primary" id="editBtn">
              <i class="fas fa-edit"></i> Edit Profile
            </button>
            <button class="btn btn-primary" id="saveBtn" hidden>
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>

        <!-- DNA Strip -->
        <div class="dna-strip" aria-hidden="true">
          <div class="dna-scene">
            <div class="dna" id="dnaRoot"></div>
          </div>
        </div>

        <!-- Grid -->
        <section class="grid">
          <!-- Personal Information -->
          <article class="card">
            <div class="card-header">
              <div class="icon"><i class="fas fa-user"></i></div>
              <div class="card-title">Personal Information</div>
            </div>
            <div class="rows">
              <div class="row">
                <div class="label">Full Name</div>
                <div class="value">
                  <div class="display" id="fullName_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="fullName_input"
                      type="text"
                      placeholder="Your full name"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Mobile</div>
                <div class="value">
                  <div class="display" id="mobileNumber_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="mobileNumber_input"
                      type="tel"
                      placeholder="+91 1234567890"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Gender</div>
                <div class="value">
                  <div class="display" id="gender_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="gender_input"
                      type="text"
                      placeholder="Male / Female / Other"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Birth Date</div>
                <div class="value">
                  <div class="display" id="birthDate_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="birthDate_input"
                      type="date"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Blood Group</div>
                <div class="value">
                  <div class="display" id="bloodGroup_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="bloodGroup_input"
                      type="text"
                      placeholder="e.g., O+, A-, AB+"
                    />
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Address -->
          <article class="card">
            <div class="card-header">
              <div class="icon"><i class="fas fa-map-marker-alt"></i></div>
              <div class="card-title">Address</div>
            </div>
            <div class="rows">
              <div class="row">
                <div class="label">Street</div>
                <div class="value">
                  <div class="display" id="streetAddress_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="streetAddress_input"
                      type="text"
                      placeholder="Street address"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">City</div>
                <div class="value">
                  <div class="display" id="city_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="city_input"
                      type="text"
                      placeholder="City"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">State</div>
                <div class="value">
                  <div class="display" id="state_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="state_input"
                      type="text"
                      placeholder="State"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">PIN</div>
                <div class="value">
                  <div class="display" id="pinCode_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="pinCode_input"
                      type="text"
                      placeholder="6-digit PIN"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Medical Information -->
          <article class="card">
            <div class="card-header">
              <div class="icon"><i class="fas fa-heartbeat"></i></div>
              <div class="card-title">Medical Information</div>
            </div>
            <div class="rows">
              <div class="row">
                <div class="label">Allergies</div>
                <div class="value">
                  <div class="display" id="allergies_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="allergies_input"
                      type="text"
                      placeholder="None"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Conditions</div>
                <div class="value">
                  <div class="display" id="medicalConditions_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="medicalConditions_input"
                      type="text"
                      placeholder="None"
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="label">Emergency Contact</div>
                <div class="value">
                  <div class="display" id="emergencyContact_display"></div>
                  <div class="editor">
                    <input
                      class="input"
                      id="emergencyContact_input"
                      type="tel"
                      placeholder="+91 1234567890"
                    />
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Reminders -->
          <article class="card reminders">
            <div class="card-header" style="justify-content: space-between">
              <div style="display: flex; align-items: center; gap: 12px">
                <div class="icon"><i class="fas fa-bell"></i></div>
                <div class="card-title">Today's Reminders</div>
              </div>
              <div class="btn" style="pointer-events: none">
                <i class="fas fa-list"></i>
                <strong id="reminderCount">0</strong>
              </div>
            </div>
            <div class="rem-list" id="reminderList"></div>
          </article>
        </section>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Mobile menu toggle
      document.getElementById("menuBtn").addEventListener("click", () => {
        document.getElementById("mobileMenu").classList.toggle("open");
      });

      // Setup navbar
      const avatar = document.getElementById("navUserAvatar");
      if (avatar) {
        avatar.addEventListener("click", () => {
          const menu = document.getElementById("userMenu");
          if (menu) {
            menu.classList.toggle("show");
          }
        });
      }

      // Close menu when clicking outside
      document.addEventListener("click", (e) => {
        const menu = document.getElementById("userMenu");
        const avatar = document.getElementById("navUserAvatar");
        if (menu && !avatar?.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove("show");
        }
      });

      // DATA (mock - used as fallback)
      const deep = (o) => JSON.parse(JSON.stringify(o));
      let userData = {
        fname: "John",
        lname: "Doe",
        email: "john@example.com",
        mobileNumber: "+91 9876543210",
        gender: "Male",
        birthDate: "1990-01-15",
        bloodGroup: "O+",
        emergencyContactNumber: "+91 9123456789",
        allergies: "Penicillin",
        medicalConditions: "Hypertension",
      };
      let addressData = {
        streetAddress: "123 Medical St",
        city: "Mumbai",
        state: "Maharashtra",
        pinCode: "400001",
      };
      let reminders = [
        {
          id: rid(),
          time: "08:00 AM",
          medicineName: "Amoxicillin",
          dosage: "500 mg",
          done: false,
        },
        {
          id: rid(),
          time: "01:00 PM",
          medicineName: "Ibuprofen",
          dosage: "200 mg",
          done: false,
        },
        {
          id: rid(),
          time: "09:00 PM",
          medicineName: "Lisinopril",
          dosage: "10 mg",
          done: false,
        },
      ];

      let user = userData;
      let addr = addressData;
      let editing = false;

      // Elements
      const toast = document.getElementById("toast");
      const editBtn = document.getElementById("editBtn");
      const saveBtn = document.getElementById("saveBtn");
      const cancelBtn = document.getElementById("cancelBtn");

      // Initialize app
      initializeApp();

      function initializeApp() {
        editBtn.addEventListener("click", () => setEdit(true));
        cancelBtn.addEventListener("click", cancelEdit);
        saveBtn.addEventListener("click", saveChanges);

        initDNA();
        fetchUserData();
      }

      function fetchUserData() {
        fetch("/api/info", {
          method: "GET",
          credentials: "include",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              console.error("Error fetching user info:", data.error);
              refreshDashboard();
            } else {
              console.log("User info fetched successfully:", data);
              userData = data.user;
              reminders = data.reminders || reminders;
              addressData = data.address;
              refreshDashboard();
            }
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
            refreshDashboard();
          });
      }

      function refreshDashboard() {
        user = userData;
        addr = addressData;
        populateUI();
        loadReminders();
      }

      function populateUI() {
        const initials = (
          user.fname.charAt(0) + user.lname.charAt(0)
        ).toUpperCase();
        document.getElementById("navUserAvatar").textContent = initials;
        document.getElementById("welcomeName").textContent = user.fname;

        setField(
          "fullName",
          `${user.fname} ${user.lname}`,
          `${user.fname} ${user.lname}`
        );
        setField("mobileNumber", user.mobileNumber);
        setField("gender", user.gender);
        setField("birthDate", formatDate(user.birthDate), user.birthDate);
        setField("bloodGroup", user.bloodGroup || "N/A");

        setField("streetAddress", addr.streetAddress);
        setField("city", addr.city);
        setField("state", addr.state);
        setField("pinCode", addr.pinCode);

        setField("allergies", user.allergies || "None");
        setField("medicalConditions", user.medicalConditions || "None");
        setField("emergencyContact", user.emergencyContactNumber || "N/A");
      }

      function setField(key, viewVal, inputVal = viewVal) {
        const d = document.getElementById(`${key}_display`);
        const i = document.getElementById(`${key}_input`);
        if (d) d.textContent = viewVal;
        if (i) i.value = inputVal;
      }

      function setEdit(on) {
        editing = on;
        document.body.classList.toggle("editing", on);
        editBtn.hidden = on;
        saveBtn.hidden = !on;
        cancelBtn.hidden = !on;

        if (on) {
          clearAllErrors();
          setTimeout(
            () => document.querySelector(".editor .input")?.focus(),
            50
          );
        }
      }

      function cancelEdit() {
        user = userData;
        addr = addressData;
        populateUI();
        setEdit(false);
        clearAllErrors();
        toastMsg("Changes discarded");
      }

      function validateForm() {
        let isValid = true;
        clearAllErrors();

        const fullName = val("fullName_input").trim();
        if (!fullName) {
          showError("fullName_input", "Name is required");
          isValid = false;
        } else if (fullName.length < 2) {
          showError("fullName_input", "Name must be at least 2 characters");
          isValid = false;
        } else if (!/^[a-zA-Z\s]+$/.test(fullName)) {
          showError(
            "fullName_input",
            "Name can only contain letters and spaces"
          );
          isValid = false;
        }

        const mobile = val("mobileNumber_input").trim();
        if (!mobile) {
          showError("mobileNumber_input", "Mobile number is required");
          isValid = false;
        } else if (!/^\+?\d{10,15}$/.test(mobile.replace(/[\s-]/g, ""))) {
          showError(
            "mobileNumber_input",
            "Enter a valid mobile number (10-15 digits)"
          );
          isValid = false;
        }

        const gender = val("gender_input").trim();
        if (!gender) {
          showError("gender_input", "Gender is required");
          isValid = false;
        }

        const birthDate = val("birthDate_input");
        if (!birthDate) {
          showError("birthDate_input", "Birth date is required");
          isValid = false;
        } else {
          const date = new Date(birthDate);
          const today = new Date();
          const age = today.getFullYear() - date.getFullYear();
          if (date > today) {
            showError("birthDate_input", "Birth date cannot be in the future");
            isValid = false;
          } else if (age > 150) {
            showError("birthDate_input", "Please enter a valid birth date");
            isValid = false;
          }
        }

        const bloodGroup = val("bloodGroup_input").trim();
        if (bloodGroup && bloodGroup !== "N/A") {
          const validBloodGroups = [
            "A+",
            "A-",
            "B+",
            "B-",
            "AB+",
            "AB-",
            "O+",
            "O-",
          ];
          if (!validBloodGroups.includes(bloodGroup.toUpperCase())) {
            showError(
              "bloodGroup_input",
              "Enter a valid blood group (e.g., O+, A-, AB+)"
            );
            isValid = false;
          }
        }

        const street = val("streetAddress_input").trim();
        if (!street) {
          showError("streetAddress_input", "Street address is required");
          isValid = false;
        } else if (street.length < 5) {
          showError(
            "streetAddress_input",
            "Address must be at least 5 characters"
          );
          isValid = false;
        }

        const city = val("city_input").trim();
        if (!city) {
          showError("city_input", "City is required");
          isValid = false;
        } else if (!/^[a-zA-Z\s]+$/.test(city)) {
          showError("city_input", "City can only contain letters");
          isValid = false;
        }

        const state = val("state_input").trim();
        if (!state) {
          showError("state_input", "State is required");
          isValid = false;
        } else if (!/^[a-zA-Z\s]+$/.test(state)) {
          showError("state_input", "State can only contain letters");
          isValid = false;
        }

        const pin = val("pinCode_input").trim();
        if (!pin) {
          showError("pinCode_input", "PIN code is required");
          isValid = false;
        } else if (!/^\d{6}$/.test(pin)) {
          showError("pinCode_input", "PIN code must be 6 digits");
          isValid = false;
        }

        const emergency = val("emergencyContact_input").trim();
        if (emergency && emergency !== "N/A") {
          if (!/^\+?\d{10,15}$/.test(emergency.replace(/[\s-]/g, ""))) {
            showError("emergencyContact_input", "Enter a valid phone number");
            isValid = false;
          }
        }

        return isValid;
      }

      function showError(inputId, message) {
        const input = document.getElementById(inputId);
        if (!input) return;

        input.classList.add("error");

        const errorEl = document.createElement("div");
        errorEl.className = "error-message";
        errorEl.textContent = message;
        errorEl.id = `${inputId}_error`;

        const editor = input.closest(".editor");
        if (editor && !document.getElementById(`${inputId}_error`)) {
          editor.appendChild(errorEl);
        }

        if (!document.querySelector(".input.error:focus")) {
          input.focus();
        }
      }

      function clearAllErrors() {
        document.querySelectorAll(".input.error").forEach((input) => {
          input.classList.remove("error");
        });

        document.querySelectorAll(".error-message").forEach((msg) => {
          msg.remove();
        });
      }

      function saveChanges() {
        if (!validateForm()) {
          toastMsg("‚ùå Please fix the errors before saving");
          return;
        }

        const fullName = val("fullName_input").trim();
        if (fullName) {
          const [first, ...rest] = fullName.split(" ");
          user.fname = first || user.fname;
          user.lname = rest.join(" ") || user.lname;
        }
        user.mobileNumber = val("mobileNumber_input").trim();
        user.gender = val("gender_input").trim();
        user.birthDate = val("birthDate_input");
        user.bloodGroup = val("bloodGroup_input").trim().toUpperCase();
        user.allergies = val("allergies_input").trim() || "None";
        user.medicalConditions =
          val("medicalConditions_input").trim() || "None";
        user.emergencyContactNumber =
          val("emergencyContact_input").trim() || "N/A";

        addr.streetAddress = val("streetAddress_input").trim();
        addr.city = val("city_input").trim();
        addr.state = val("state_input").trim();
        addr.pinCode = val("pinCode_input").trim();

        userData = deep(user);
        addressData = deep(addr);

        populateUI();
        setEdit(false);
        toastMsg("‚úÖ Profile updated successfully");

        fetch("/api/updateUser/", {
          method: "PUT",
          credentials: "include",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            mobileNumber: user.mobileNumber.replace(/[^0-9]/g, "").slice(-10),
            emergencyContactNumber: user.emergencyContactNumber
              .replace(/[^0-9]/g, "")
              .slice(-10),
            birthDate: user.birthDate,
            city: addr.city,
            gender: user.gender,
            streetAddress: addr.streetAddress,
            state: addr.state,
            pinCode: addr.pinCode,
            country: "India",
            bloodGroup: user.bloodGroup,
            medicalConditions: user.medicalConditions,
            allergies: user.allergies,
          }).toString(),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Profile saved to backend:", data);
            if (data.success) {
              toastMsg("‚úÖ Saved to server");
            }
          })
          .catch((error) => {
            console.error("Error saving to backend:", error);
            toastMsg("‚ö†Ô∏è Saved locally, but server update failed");
          });
      }

      function val(id) {
        return document.getElementById(id)?.value ?? "";
      }

      function loadReminders() {
        reminders.sort((a, b) => toMin(a.time) - toMin(b.time));
        const list = document.getElementById("reminderList");
        document.getElementById("reminderCount").textContent = reminders.length;

        if (!reminders.length) {
          list.innerHTML = `<div class="row" style="justify-content:center;text-align:center;padding:30px;">No reminders for today üéâ</div>`;
          return;
        }

        list.innerHTML = reminders
          .map(
            (r) => `
            <div class="rem" data-id="${r.id}">
              <div class="time">
                <div class="big">${r.time}</div>
                <div class="small">Time</div>
              </div>
              <div class="med">
                <div class="name">${escape(r.medicineName)}</div>
                <div class="dose">Dosage: ${escape(r.dosage)}</div>
              </div>
              <div class="chips">
                <button class="chip ${
                  r.done ? "done" : ""
                }" data-action="done">${
              r.done ? "‚úì Done" : "Mark Done"
            }</button>
                <button class="chip" data-action="snooze">Snooze +10m</button>
              </div>
            </div>
          `
          )
          .join("");

        list.querySelectorAll(".chip").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const card = e.currentTarget.closest(".rem");
            const id = card?.dataset.id;
            const item = reminders.find((x) => x.id === id);
            if (!item) return;
            const action = e.currentTarget.dataset.action;
            if (action === "done") {
              item.done = !item.done;
              loadReminders();
              toastMsg(item.done ? "üíä Marked done" : "Marked pending");
            }
            if (action === "snooze") {
              toastMsg("‚è±Ô∏è Snoozed 10 minutes");
            }
          });
        });
      }

      function initDNA() {
        const root = document.getElementById("dnaRoot");
        if (!root) return;

        const scene = root.parentElement;
        const prefersReduced = window.matchMedia(
          "(prefers-reduced-motion: reduce)"
        ).matches;
        const isMobile = window.matchMedia("(max-width: 480px)").matches;

        const N = isMobile ? 36 : 52;
        const radiusY = 18;
        const radiusZ = 70;
        const turns = 2.2;
        const speed = 0.4;

        const nodesA = [];
        const nodesB = [];
        for (let i = 0; i < N; i++) {
          const a = document.createElement("span");
          a.className = "node";
          const b = document.createElement("span");
          b.className = "node";
          root.appendChild(a);
          root.appendChild(b);
          nodesA.push(a);
          nodesB.push(b);
        }

        function layout(time) {
          const w = scene.clientWidth;
          const usableW = w - 80;
          const phase = (time / 1000) * speed * Math.PI * 2 * 0.12;

          root.style.transform = "translate3d(-50%,-50%,0)";

          for (let i = 0; i < N; i++) {
            const t = i / (N - 1);
            const x = (t - 0.5) * usableW;
            const ang = t * turns * Math.PI * 2 + phase;

            const yA = Math.sin(ang) * radiusY;
            const zA = Math.cos(ang) * radiusZ;

            const yB = -yA;
            const zB = -zA;

            const depthA = (zA + radiusZ) / (2 * radiusZ);
            const depthB = (zB + radiusZ) / (2 * radiusZ);

            const scaleA = 0.85 + depthA * 0.35;
            const scaleB = 0.85 + depthB * 0.35;

            const a = nodesA[i];
            const b = nodesB[i];

            a.style.transform = `translate3d(${x}px, ${yA}px, ${zA}px) scale(${scaleA})`;
            b.style.transform = `translate3d(${x}px, ${yB}px, ${zB}px) scale(${scaleB})`;

            a.classList.toggle("back", zA < 0);
            b.classList.toggle("back", zB < 0);
          }
        }

        if (!prefersReduced) {
          let raf;
          const tick = (t) => {
            layout(t);
            raf = requestAnimationFrame(tick);
          };
          raf = requestAnimationFrame(tick);
          window.addEventListener("resize", () => layout(performance.now()));
        } else {
          layout(0);
        }
      }

      function formatDate(dstr) {
        if (!dstr) return "Not specified";
        const d = new Date(dstr);
        return d.toLocaleDateString(undefined, {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function toMin(t12) {
        const [t, mer] = t12.split(" ");
        let [h, m] = t.split(":").map(Number);
        if (mer === "PM" && h !== 12) h += 12;
        if (mer === "AM" && h === 12) h = 0;
        return h * 60 + m;
      }

      function toastMsg(msg) {
        const el = document.createElement("div");
        el.className = "toast-item";
        el.textContent = msg;
        toast.appendChild(el);
        setTimeout(() => {
          el.style.transition = "opacity .3s ease, transform .3s ease";
          el.style.opacity = "0";
          el.style.transform = "translateY(10px)";
          setTimeout(() => el.remove(), 250);
        }, 2500);
      }

      function escape(s) {
        return s.replace(
          /[&<>"']/g,
          (c) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[c])
        );
      }

      function rid() {
        return Math.random().toString(36).slice(2);
      }

      // Canvas Animation
      function n(e) {
        this.init(e || {});
      }
      n.prototype = {
        init: function (e) {
          this.phase = e.phase || 0;
          this.offset = e.offset || 0;
          this.frequency = e.frequency || 0.001;
          this.amplitude = e.amplitude || 1;
        },
        update: function () {
          return (
            (this.phase += this.frequency),
            (window.canvasE =
              this.offset + Math.sin(this.phase) * this.amplitude)
          );
        },
        value: function () {
          return window.canvasE;
        },
      };

      function Line(e) {
        this.init(e || {});
      }

      Line.prototype = {
        init: function (e) {
          this.spring = e.spring + 0.1 * Math.random() - 0.05;
          this.friction = window.E.friction + 0.01 * Math.random() - 0.005;
          this.nodes = [];
          for (var t, n = 0; n < window.E.size; n++) {
            t = new Node();
            t.x = window.pos.x;
            t.y = window.pos.y;
            this.nodes.push(t);
          }
        },
        update: function () {
          let e = this.spring,
            t = this.nodes[0];
          t.vx += (window.pos.x - t.x) * e;
          t.vy += (window.pos.y - t.y) * e;
          for (var n, i = 0, a = this.nodes.length; i < a; i++)
            (t = this.nodes[i]),
              0 < i &&
                ((n = this.nodes[i - 1]),
                (t.vx += (n.x - t.x) * e),
                (t.vy += (n.y - t.y) * e),
                (t.vx += n.vx * window.E.dampening),
                (t.vy += n.vy * window.E.dampening)),
              (t.vx *= this.friction),
              (t.vy *= this.friction),
              (t.x += t.vx),
              (t.y += t.vy),
              (e *= window.E.tension);
        },
        draw: function () {
          let e,
            t,
            n = this.nodes[0].x,
            i = this.nodes[0].y;
          window.ctx.beginPath();
          window.ctx.moveTo(n, i);
          for (var a = 1, o = this.nodes.length - 2; a < o; a++) {
            e = this.nodes[a];
            t = this.nodes[a + 1];
            n = 0.5 * (e.x + t.x);
            i = 0.5 * (e.y + t.y);
            window.ctx.quadraticCurveTo(e.x, e.y, n, i);
          }
          e = this.nodes[a];
          t = this.nodes[a + 1];
          window.ctx.quadraticCurveTo(e.x, e.y, t.x, t.y);
          window.ctx.stroke();
          window.ctx.closePath();
        },
      };

      function onMousemove(e) {
        function o() {
          window.lines = [];
          for (let e = 0; e < window.E.trails; e++)
            window.lines.push(
              new Line({ spring: 0.45 + (e / window.E.trails) * 0.025 })
            );
        }
        function c(e) {
          e.touches
            ? ((window.pos.x = e.touches[0].pageX),
              (window.pos.y = e.touches[0].pageY))
            : ((window.pos.x = e.clientX), (window.pos.y = e.clientY)),
            e.preventDefault();
        }
        function l(e) {
          1 == e.touches.length &&
            ((window.pos.x = e.touches[0].pageX),
            (window.pos.y = e.touches[0].pageY));
        }
        document.removeEventListener("mousemove", onMousemove),
          document.removeEventListener("touchstart", onMousemove),
          document.addEventListener("mousemove", c),
          document.addEventListener("touchmove", c),
          document.addEventListener("touchstart", l),
          c(e),
          o(),
          render();
      }

      function render() {
        if (window.ctx.running) {
          window.ctx.globalCompositeOperation = "source-over";
          window.ctx.clearRect(
            0,
            0,
            window.ctx.canvas.width,
            window.ctx.canvas.height
          );
          window.ctx.globalCompositeOperation = "lighter";
          window.ctx.strokeStyle =
            "hsla(" + Math.round(window.f.update()) + ",100%,50%,0.025)";
          window.ctx.lineWidth = 10;
          for (var e, t = 0; t < window.E.trails; t++) {
            (e = window.lines[t]).update();
            e.draw();
          }
          window.ctx.frame++;
          window.requestAnimationFrame(render);
        }
      }

      function resizeCanvas() {
        window.ctx.canvas.width = window.innerWidth;
        window.ctx.canvas.height = window.innerHeight;
      }

      window.canvasE = 0;
      window.pos = {};
      window.lines = [];
      window.E = {
        debug: true,
        friction: 0.5,
        trails: 80,
        size: 50,
        dampening: 0.025,
        tension: 0.99,
      };

      function Node() {
        this.x = 0;
        this.y = 0;
        this.vy = 0;
        this.vx = 0;
      }

      function renderCanvas() {
        window.ctx = document.getElementById("canvas").getContext("2d");
        if (!window.ctx) return;
        window.ctx.running = true;
        window.ctx.frame = 1;
        window.f = new n({
          phase: Math.random() * 2 * Math.PI,
          amplitude: 85,
          frequency: 0.0015,
          offset: 285,
        });
        document.addEventListener("mousemove", onMousemove);
        document.addEventListener("touchstart", onMousemove);
        document.body.addEventListener("orientationchange", resizeCanvas);
        window.addEventListener("resize", resizeCanvas);
        window.addEventListener("focus", () => {
          if (!window.ctx.running) {
            window.ctx.running = true;
            render();
          }
        });
        window.addEventListener("blur", () => {
          window.ctx.running = true;
        });
        resizeCanvas();
      }

      window.addEventListener("load", renderCanvas);
    </script>
  </body>
</html>
